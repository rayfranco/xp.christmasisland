(function(){var e;e=function(){function e(){}return e}()}).call(this),function(){var e;e=function(){function e(){}return e}()}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var s in n)e.call(n,s)&&(t[s]=n[s]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};if("undefined"==typeof $||null===$)throw"jQuery is not installed";if("undefined"==typeof buzz||null===buzz)throw"Buzz is not installed";$(function(){var e,n,i,s,a,r,o,u,d,l,c,E,h,w,p,g,y,f,m,T,H,v,R,z,b,x,W,M,S,I,P,k,C,N,B,L,j,G,O,V,U,F,A,_,$,q,D,Q,J,K,X,Y,Z,et,tt,nt,it,st,at,rt;return r=500,e=200,l=1,a=12e4,c=75,i=200,n=0,d=.5,s=5e3,P=.1,R=0,v=0,f=!1,U=new THREE.Scene,p=new THREE.PerspectiveCamera(c,window.innerWidth/window.innerHeight,l,a),p.position.z=i,p.position.y=n,U.add(p),F=document.getElementById("scene"),L={canvas:F,antialias:!1},O=new THREE.WebGLRenderer(L),O.setSize(window.innerWidth,window.innerHeight),O.setClearColorHex(0,0),O.autoClear=!1,O.gammaInput=!0,O.gammaOutput=!0,O.setSize(window.innerWidth,window.innerHeight),G=new THREE.RenderPass(U,p),T=new THREE.FilmPass(3,.1,0,!0),H=new THREE.ShaderPass(THREE.VignetteShader),H.uniforms.offset.value=.8,H.uniforms.darkness.value=2,H.renderToScreen=!0,V={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,stencilBuffer:!0},g=new THREE.EffectComposer(O,new THREE.WebGLRenderTarget(window.innerWidth,window.innerHeight,V)),g.addPass(G),g.addPass(T),g.addPass(H),et=document.getElementById("trackerCanvas"),tt=document.getElementById("trackerVideo"),x=new headtrackr.Tracker({ui:!1,headPosition:!0,calcAngles:!1}),x.init(tt,et),x.start(),nt="assets/textures/skybox/",it=[nt+"posx.jpg",nt+"negx.jpg",nt+"posy.jpg",nt+"negy.jpg",nt+"posz.jpg",nt+"negz.jpg"],Q=THREE.ImageUtils.loadTextureCube(it),z=new THREE.SphereGeometry(100,32,16),S=new THREE.MeshBasicMaterial({color:16777215,envMap:Q}),E=new THREE.Mesh(z,S),E.position.x=0,E.position.y=0,E.position.z=0,E.scale.x=E.scale.y=E.scale.z=1,U.add(E),h=new TWEEN.Tween(E.position).to({y:-20},5e3).easing(TWEEN.Easing.Cubic.InOut),w=new TWEEN.Tween(E.position).to({y:20},5e3).easing(TWEEN.Easing.Cubic.InOut),q=new TWEEN.Tween(E.position).to({y:20},2500).start().chain(h).easing(TWEEN.Easing.Cubic.Out),h.chain(w),w.chain(h),A=THREE.ShaderUtils.lib.cube,_={fragmentShader:A.fragmentShader,vertexShader:A.vertexShader,uniforms:A.uniforms,depthWrite:!1,side:THREE.BackSide},A.uniforms.tCube.value=Q,S=new THREE.ShaderMaterial(_),I=new THREE.Mesh(new THREE.CubeGeometry(1e4,1e4,1e4),S),U.add(I),B=new THREE.PointLight(255),B.position.x=10,B.position.y=50,B.position.z=130,U.add(B),m=new THREE.DirectionalLight(16777215,1),m.position.x=1,m.position.y=1,m.position.z=0,U.add(m),W=new THREE.AmbientLight(6710886),U.add(W),u=function(){function e(e,t,n){var i,s,a,r;for(this.scene=e,this.subject=t,this.count=n,this.flakes=new THREE.Geometry,this.material=new THREE.ParticleBasicMaterial({size:5,map:THREE.ImageUtils.loadTexture("assets/particle.png"),blending:THREE.AdditiveBlending,transparent:!0}),this.points=new THREE.GeometryUtils.randomPointsInGeometry(this.subject,this.count),i=a=0,r=this.count;r>=0?r>a:a>r;i=r>=0?++a:--a)this.points[i]=new THREE.Vector3(400*Math.random()-200,400*Math.random()-200,2e3*Math.random()-1e3),s=new o(this.points[i],50),this.flakes.vertices.push(s);return this.system=new THREE.ParticleSystem(this.flakes,this.material),this.system.sortParticles=!0,this.scene.add(this.system),this}return e.prototype.update=function(){var e,t,n,i;for(i=this.flakes.vertices,t=0,n=i.length;n>t;t++)e=i[t],-200>e.y&&(e.y=200),-200>e.x&&(e.x=200),e.x>200?e.x=-200:(e.y-=50*Math.random()*P,e.x-=20*Math.random()*P);return this.flakes.vertices.verticesNeedUpdate=!0},e}(),o=function(e){function n(e,t){return null==t&&(t=2),this.velocity=new THREE.Vector3(0,-Math.random()+1,0),this.animation=null,this.x=e.x,this.y=e.y,this.z=e.z,this}return t(n,e),n}(THREE.Vector3),D=new u(U,z,r),$={preload:!0,autoplay:!1,loop:!0},X=new buzz.sound("assets/loop1.wav",$),K=new buzz.sound("assets/loop2.wav",$),J=new buzz.sound("assets/loop3.wav",$),buzz.all().bindOnce("canplaythrough",function(){return buzz.all().play()}),st=100,at=50,rt=0,Y=.5,Z=.5,j=function(){var e,t;return requestAnimationFrame(j),TWEEN.update(),D.update(),p.lookAt({x:0,y:0,z:0}),e=400*Y-200,t=Math.sqrt(Math.pow(201,2)-Math.pow(e,2)),new TWEEN.Tween(p.position).to({x:e,z:t},980).easing(TWEEN.Easing.Cubic.Out).start(),P>.5?E.material.color.setRGB(1,1-(2*P-1),1-(2*P-1)):E.material.color.setRGB(1,1,1),J.setVolume(st),K.setVolume(at),X.setVolume(rt),O.render(U,p),g.render(.005)},j(),C=function(e){return"found"===e.status?(f=!0,M(),setTimeout(b,s)):"lost"===e.status||"redetecting"===e.status?(f=!1,y()):void 0},k=function(e){var t,n;return Y=P=1-e.x/318,Z=1-e.y/240,Y>.5?(n=2*Y-.5,n>R&&(R=n)):(t=2*Y,t>v&&(v=t)),st=100*Y,at=-100*Math.cos(1.5*Y*Math.PI),rt=100-150*Y},N=function(){return O.setSize(window.innerWidth,window.innerHeight),F.style.height=window.innerHeight+"px",p.aspect=window.innerWidth/window.innerHeight,p.updateProjectionMatrix(),g.reset(new THREE.WebGLRenderTarget(window.innerWidth,window.innerHeight,V))},b=function(){return console.log("explore",v,R),d>v&&console.log("Step on your left !"),d>R?console.log("Step on your right !"):void 0},y=function(){var e;return e=new TWEEN.Tween({grayscale:0,nIntensity:.3}).to({grayscale:1,nIntensity:3},500).easing(TWEEN.Easing.Cubic.Out),e.onUpdate(function(){return T.uniforms.grayscale.value=this.grayscale,T.uniforms.nIntensity.value=this.nIntensity}),e.start()},M=function(){var e;return e=new TWEEN.Tween({grayscale:1,nIntensity:3}).to({grayscale:0,nIntensity:.3},500).easing(TWEEN.Easing.Cubic.Out),e.onUpdate(function(){return T.uniforms.grayscale.value=this.grayscale,T.uniforms.nIntensity.value=this.nIntensity}),e.start()},document.addEventListener("headtrackrStatus",C),document.addEventListener("facetrackingEvent",k),window.addEventListener("resize",N)})}.call(this);